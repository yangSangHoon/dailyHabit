"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var model_1 = require("../../model/model");
var buttonModule = require("ui/button");
var builder = require('ui/builder');
var util_1 = require("../../util/util");
var frameModule = require("ui/frame");
var DailyCheck = (function () {
    function DailyCheck(page) {
        this.btnSubmit = page.getViewById('btnSubmit');
        this.habitContainer = page.getViewById('habitContainer');
        this.btnTomorrow = page.getViewById('btnTomorrow');
        this.btnYesterday = page.getViewById('btnYesterday');
        this.date = page.getViewById('date');
        this.btnResult = page.getViewById('btnResult');
        this.defaultSetting();
        this.goYesterday();
        this.eventSetting();
        this.makeMyHabits();
    }
    DailyCheck.prototype.defaultSetting = function () {
        this.todayDate = new Date();
        this.setDate(this.todayDate);
    };
    DailyCheck.prototype.setDate = function (date) {
        this.date.text = date.getFullYear() + "." + util_1.addZeroDigit(date.getMonth() + 1) + "." + util_1.addZeroDigit(date.getDate());
    };
    DailyCheck.prototype.eventSetting = function () {
        var _this = this;
        this.btnSubmit.on(buttonModule.Button.tapEvent, function () {
            _this.goSubmit();
        });
        this.btnTomorrow.on(buttonModule.Button.tapEvent, function () {
            _this.goTommorrow();
        });
        this.btnYesterday.on(buttonModule.Button.tapEvent, function () {
            _this.goYesterday();
        });
        this.btnResult.on(buttonModule.Button.tapEvent, function () {
            _this.goResult();
        });
    };
    DailyCheck.prototype.goTommorrow = function () {
        this.todayDate.setDate(this.todayDate.getDate() + 1);
        this.setDate(this.todayDate);
    };
    DailyCheck.prototype.goYesterday = function () {
        this.todayDate.setDate(this.todayDate.getDate() - 1);
        this.setDate(this.todayDate);
    };
    DailyCheck.prototype.makeMyHabits = function () {
        return __awaiter(this, void 0, void 0, function () {
            var _this = this;
            var myHabits;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, model_1.default.userInfo.getMyHabits()];
                    case 1:
                        myHabits = _a.sent();
                        console.log('myHabitsmyHabits', JSON.stringify(myHabits));
                        if (myHabits && myHabits.length > 0) {
                            myHabits.forEach(function (habit) {
                                _this.addHabit(habit);
                            });
                        }
                        return [2 /*return*/];
                }
            });
        });
    };
    DailyCheck.prototype.addHabit = function (habitDbData) {
        var habit = builder.load({
            path: '/component/create/habit',
            name: 'habit'
        });
        habit.getViewById('habitName').text = habitDbData.title;
        this.habitContainer.addChild(habit);
    };
    DailyCheck.prototype.goSubmit = function () {
        var habits = [];
        this.habitContainer.eachChildView(function (child) {
            habits.push({
                title: child.getViewById('habitName').text,
                value: Number(child.getViewById('habitCount').text)
            });
        });
        var date = this.date.text.split('.').join('');
        model_1.default.userInfo.setDailyHabits({ date: date, habits: habits });
        this.goResult();
    };
    DailyCheck.prototype.logout = function () {
        model_1.default.userInfo.logout();
    };
    DailyCheck.prototype.goResult = function () {
        var topmost = frameModule.topmost();
        topmost.navigate("component/main/main");
    };
    return DailyCheck;
}());
exports.navigated = function (args) {
    new DailyCheck(args.object);
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGFpbHlDaGVjay5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImRhaWx5Q2hlY2sudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSwyQ0FBc0M7QUFDdEMsd0NBQTJDO0FBQzNDLElBQU0sT0FBTyxHQUFHLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQztBQUN0Qyx3Q0FBNkM7QUFDN0Msc0NBQXlDO0FBRXpDO0lBVUksb0JBQVksSUFBSTtRQUNaLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUMvQyxJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztRQUN6RCxJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsYUFBYSxDQUFDLENBQUM7UUFDbkQsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBQ3JELElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNyQyxJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsV0FBVyxDQUFDLENBQUM7UUFFL0MsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO1FBQ3RCLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUNuQixJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7UUFDcEIsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO0lBQ3hCLENBQUM7SUFFTyxtQ0FBYyxHQUF0QjtRQUNJLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztRQUM1QixJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUNqQyxDQUFDO0lBRU8sNEJBQU8sR0FBZixVQUFnQixJQUFJO1FBQ2hCLElBQUksQ0FBQyxJQUFJLENB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QUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsWUFBWSxDQUFDLENBQUMsSUFBSSxDQUFDO2FBQ3RELENBQUMsQ0FBQztRQUNQLENBQUMsQ0FBQyxDQUFDO1FBQ0gsSUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNoRCxlQUFLLENBQUMsUUFBUSxDQUFDLGNBQWMsQ0FBQyxFQUFDLElBQUksTUFBQSxFQUFFLE1BQU0sUUFBQSxFQUFDLENBQUMsQ0FBQztRQUM5QyxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7SUFDcEIsQ0FBQztJQUVNLDJCQUFNLEdBQWI7UUFDSSxlQUFLLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRSxDQUFDO0lBQzVCLENBQUM7SUFFTyw2QkFBUSxHQUFoQjtRQUNJLElBQU0sT0FBTyxHQUFHLFdBQVcsQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUN0QyxPQUFPLENBQUMsUUFBUSxDQUFDLHFCQUFxQixDQUFDLENBQUM7SUFDNUMsQ0FBQztJQUNMLGlCQUFDO0FBQUQsQ0FBQyxBQXBHRCxJQW9HQztBQUVELE9BQU8sQ0FBQyxTQUFTLEdBQUcsVUFBVSxJQUFJO0lBQzlCLElBQUksVUFBVSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUNoQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgbW9kZWwgZnJvbSAnLi4vLi4vbW9kZWwvbW9kZWwnO1xuaW1wb3J0IGJ1dHRvbk1vZHVsZSA9IHJlcXVpcmUoXCJ1aS9idXR0b25cIik7XG5jb25zdCBidWlsZGVyID0gcmVxdWlyZSgndWkvYnVpbGRlcicpO1xuaW1wb3J0IHthZGRaZXJvRGlnaXR9IGZyb20gJy4uLy4uL3V0aWwvdXRpbCc7XG5pbXBvcnQgZnJhbWVNb2R1bGUgPSByZXF1aXJlKFwidWkvZnJhbWVcIik7XG5cbmNsYXNzIERhaWx5Q2hlY2sge1xuXG4gICAgcHJpdmF0ZSBidG5TdWJtaXQ7XG4gICAgcHJpdmF0ZSBoYWJpdENvbnRhaW5lcjtcbiAgICBwcml2YXRlIGJ0blRvbW9ycm93O1xuICAgIHByaXZhdGUgYnRuWWVzdGVyZGF5O1xuICAgIHByaXZhdGUgZGF0ZTtcbiAgICBwcml2YXRlIHRvZGF5RGF0ZTtcbiAgICBwcml2YXRlIGJ0blJlc3VsdDtcblxuICAgIGNvbnN0cnVjdG9yKHBhZ2Upe1xuICAgICAgICB0aGlzLmJ0blN1Ym1pdCA9IHBhZ2UuZ2V0Vmlld0J5SWQoJ2J0blN1Ym1pdCcpO1xuICAgICAgICB0aGlzLmhhYml0Q29udGFpbmVyID0gcGFnZS5nZXRWaWV3QnlJZCgnaGFiaXRDb250YWluZXInKTtcbiAgICAgICAgdGhpcy5idG5Ub21vcnJvdyA9IHBhZ2UuZ2V0Vmlld0J5SWQoJ2J0blRvbW9ycm93Jyk7XG4gICAgICAgIHRoaXMuYnRuWWVzdGVyZGF5ID0gcGFnZS5nZXRWaWV3QnlJZCgnYnRuWWVzdGVyZGF5Jyk7XG4gICAgICAgIHRoaXMuZGF0ZSA9IHBhZ2UuZ2V0Vmlld0J5SWQoJ2RhdGUnKTtcbiAgICAgICAgdGhpcy5idG5SZXN1bHQgPSBwYWdlLmdldFZpZXdCeUlkKCdidG5SZXN1bHQnKTtcblxuICAgICAgICB0aGlzLmRlZmF1bHRTZXR0aW5nKCk7XG4gICAgICAgIHRoaXMuZ29ZZXN0ZXJkYXkoKTtcbiAgICAgICAgdGhpcy5ldmVudFNldHRpbmcoKTtcbiAgICAgICAgdGhpcy5tYWtlTXlIYWJpdHMoKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGRlZmF1bHRTZXR0aW5nKCkge1xuICAgICAgICB0aGlzLnRvZGF5RGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgICAgIHRoaXMuc2V0RGF0ZSh0aGlzLnRvZGF5RGF0ZSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzZXREYXRlKGRhdGUpe1xuICAgICAgICB0aGlzLmRhdGUudGV4dCA9IGAke2RhdGUuZ2V0RnVsbFllYXIoKX0uJHthZGRaZXJvRGlnaXQoZGF0ZS5nZXRNb250aCgpKzEpfS4ke2FkZFplcm9EaWdpdChkYXRlLmdldERhdGUoKSl9YDtcbiAgICB9XG5cbiAgICBwcml2YXRlIGV2ZW50U2V0dGluZygpIHtcbiAgICAgICAgdGhpcy5idG5TdWJtaXQub24oYnV0dG9uTW9kdWxlLkJ1dHRvbi50YXBFdmVudCwgKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5nb1N1Ym1pdCgpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5idG5Ub21vcnJvdy5vbihidXR0b25Nb2R1bGUuQnV0dG9uLnRhcEV2ZW50LCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmdvVG9tbW9ycm93KCk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmJ0blllc3RlcmRheS5vbihidXR0b25Nb2R1bGUuQnV0dG9uLnRhcEV2ZW50LCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmdvWWVzdGVyZGF5KCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuYnRuUmVzdWx0Lm9uKGJ1dHRvbk1vZHVsZS5CdXR0b24udGFwRXZlbnQsICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZ29SZXN1bHQoKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnb1RvbW1vcnJvdygpIHtcbiAgICAgICAgdGhpcy50b2RheURhdGUuc2V0RGF0ZSh0aGlzLnRvZGF5RGF0ZS5nZXREYXRlKCkgKyAxKTtcbiAgICAgICAgdGhpcy5zZXREYXRlKHRoaXMudG9kYXlEYXRlKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdvWWVzdGVyZGF5KCkge1xuICAgICAgICB0aGlzLnRvZGF5RGF0ZS5zZXREYXRlKHRoaXMudG9kYXlEYXRlLmdldERhdGUoKSAtIDEpO1xuICAgICAgICB0aGlzLnNldERhdGUodGhpcy50b2RheURhdGUpO1xuICAgIH1cblxuICAgIHByaXZhdGUgYXN5bmMgbWFrZU15SGFiaXRzKCkge1xuICAgICAgICBjb25zdCBteUhhYml0cyA9IGF3YWl0IG1vZGVsLnVzZXJJbmZvLmdldE15SGFiaXRzKCk7XG4gICAgICAgIGNvbnNvbGUubG9nKCdteUhhYml0c215SGFiaXRzJywgSlNPTi5zdHJpbmdpZnkobXlIYWJpdHMpKTtcbiAgICAgICAgaWYobXlIYWJpdHMgJiYgbXlIYWJpdHMubGVuZ3RoID4gMCl7XG4gICAgICAgICAgICBteUhhYml0cy5mb3JFYWNoKGhhYml0ID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFkZEhhYml0KGhhYml0KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhZGRIYWJpdChoYWJpdERiRGF0YSkge1xuICAgICAgICBjb25zdCBoYWJpdCA9IGJ1aWxkZXIubG9hZCh7XG4gICAgICAgICAgICBwYXRoOiAnL2NvbXBvbmVudC9jcmVhdGUvaGFiaXQnLFxuICAgICAgICAgICAgbmFtZTogJ2hhYml0J1xuICAgICAgICB9KTtcblxuICAgICAgICBoYWJpdC5nZXRWaWV3QnlJZCgnaGFiaXROYW1lJykudGV4dCA9IGhhYml0RGJEYXRhLnRpdGxlO1xuICAgICAgICB0aGlzLmhhYml0Q29udGFpbmVyLmFkZENoaWxkKGhhYml0KTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ29TdWJtaXQoKXtcbiAgICAgICAgbGV0IGhhYml0czogQXJyYXk8T2JqZWN0PiA9IFtdO1xuICAgICAgICB0aGlzLmhhYml0Q29udGFpbmVyLmVhY2hDaGlsZFZpZXcoY2hpbGQgPT4ge1xuICAgICAgICAgICAgaGFiaXRzLnB1c2goe1xuICAgICAgICAgICAgICAgIHRpdGxlOiBjaGlsZC5nZXRWaWV3QnlJZCgnaGFiaXROYW1lJykudGV4dCxcbiAgICAgICAgICAgICAgICB2YWx1ZTogTnVtYmVyKGNoaWxkLmdldFZpZXdCeUlkKCdoYWJpdENvdW50JykudGV4dClcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgZGF0ZSA9IHRoaXMuZGF0ZS50ZXh0LnNwbGl0KCcuJykuam9pbignJyk7XG4gICAgICAgIG1vZGVsLnVzZXJJbmZvLnNldERhaWx5SGFiaXRzKHtkYXRlLCBoYWJpdHN9KTtcbiAgICAgICAgdGhpcy5nb1Jlc3VsdCgpO1xuICAgIH1cblxuICAgIHB1YmxpYyBsb2dvdXQoKSB7XG4gICAgICAgIG1vZGVsLnVzZXJJbmZvLmxvZ291dCgpO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ29SZXN1bHQoKSB7XG4gICAgICAgIGNvbnN0IHRvcG1vc3QgPSBmcmFtZU1vZHVsZS50b3Btb3N0KCk7XG4gICAgICAgIHRvcG1vc3QubmF2aWdhdGUoXCJjb21wb25lbnQvbWFpbi9tYWluXCIpO1xuICAgIH1cbn1cblxuZXhwb3J0cy5uYXZpZ2F0ZWQgPSBmdW5jdGlvbiAoYXJncykge1xuICAgIG5ldyBEYWlseUNoZWNrKGFyZ3Mub2JqZWN0KTtcbn07Il19