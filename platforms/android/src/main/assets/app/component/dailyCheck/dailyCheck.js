"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var model_1 = require("../../model/model");
var buttonModule = require("ui/button");
var builder = require('ui/builder');
var util_1 = require("../../util/util");
var frameModule = require("ui/frame");
var DailyCheck = (function () {
    function DailyCheck(page) {
        this.btnSubmit = page.getViewById('btnSubmit');
        this.habitContainer = page.getViewById('habitContainer');
        this.btnTomorrow = page.getViewById('btnTomorrow');
        this.btnYesterday = page.getViewById('btnYesterday');
        this.date = page.getViewById('date');
        this.btnResult = page.getViewById('btnResult');
        this.defaultSetting();
        this.eventSetting();
        this.makeMyHabits(model_1.default.userInfo.myHabits);
    }
    DailyCheck.prototype.defaultSetting = function () {
        this.todayDate = new Date();
        this.setDate(this.todayDate);
    };
    DailyCheck.prototype.setDate = function (date) {
        this.date.text = date.getFullYear() + "." + util_1.addZeroDigit(date.getMonth() + 1) + "." + date.getDate();
    };
    DailyCheck.prototype.addHabit = function (habitDbData) {
        if (habitDbData === void 0) { habitDbData = null; }
        var habit = builder.load({
            path: '/component/create/habit',
            name: 'habit'
        });
        habit.getViewById('habitName').text = habitDbData.title;
        this.habitContainer.addChild(habit);
    };
    DailyCheck.prototype.eventSetting = function () {
        var _this = this;
        this.btnSubmit.on(buttonModule.Button.tapEvent, function () {
            _this.goSubmit();
        });
        this.btnTomorrow.on(buttonModule.Button.tapEvent, function () {
            _this.goTommorrow();
        });
        this.btnYesterday.on(buttonModule.Button.tapEvent, function () {
            _this.goYesterday();
        });
        this.btnResult.on(buttonModule.Button.tapEvent, function () {
            _this.goResult();
        });
    };
    DailyCheck.prototype.goTommorrow = function () {
        this.todayDate.setDate(this.todayDate.getDate() + 1);
        this.setDate(this.todayDate);
    };
    DailyCheck.prototype.goYesterday = function () {
        this.todayDate.setDate(this.todayDate.getDate() - 1);
        this.setDate(this.todayDate);
    };
    DailyCheck.prototype.makeMyHabits = function (myHabits) {
        var _this = this;
        console.log('myHabitsmyHabits', JSON.stringify(myHabits));
        if (!myHabits || myHabits.length == 0) {
            this.addHabit();
        }
        else {
            myHabits.forEach(function (habit) {
                _this.addHabit(habit);
            });
        }
    };
    DailyCheck.prototype.goSubmit = function () {
        var habits = [];
        this.habitContainer.eachChildView(function (child) {
            habits.push({
                title: child.getViewById('habitName').text,
                value: Number(child.getViewById('habitCount').text)
            });
        });
        var date = this.date.text.split('.').join('');
        model_1.default.userInfo.setDailyHabits({ date: date, habits: habits });
    };
    DailyCheck.prototype.logout = function () {
        model_1.default.userInfo.logout();
    };
    DailyCheck.prototype.goResult = function () {
        var topmost = frameModule.topmost();
        topmost.navigate("component/result/result");
    };
    return DailyCheck;
}());
var dailyCheck = null;
exports.navigated = function (args) {
    if (!dailyCheck) {
        dailyCheck = new DailyCheck(args.object);
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGFpbHlDaGVjay5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImRhaWx5Q2hlY2sudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSwyQ0FBc0M7QUFDdEMsd0NBQTJDO0FBQzNDLElBQU0sT0FBTyxHQUFHLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQztBQUN0Qyx3Q0FBNkM7QUFDN0Msc0NBQXlDO0FBRXpDO0lBVUksb0JBQVksSUFBSTtRQUNaLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUMvQyxJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztRQUN6RCxJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsYUFBYSxDQUFDLENBQUM7UUFDbkQsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBQ3JELElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNyQyxJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsV0FBVyxDQUFDLENBQUM7UUFFL0MsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO1FBQ3RCLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUNwQixJQUFJLENBQUMsWUFBWSxDQUFDLGVBQUssQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDL0MsQ0FBQztJQUVPLG1DQUFjLEdBQXRCO1FBQ0ksSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDO1FBQzVCLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQ2pDLENBQUM7SUFFTyw0QkFBTyxHQUFmLFVBQWdCLElBQUk7UUFDaEIsSUFBSSxDQUFDLElBQUksQ0FB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QUFLLEVBQUUsTUFBTSxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsWUFBWSxDQUFDLENBQUMsSUFBSSxDQUFDO2FBQ3RELENBQUMsQ0FBQztRQUNQLENBQUMsQ0FBQyxDQUFDO1FBQ0gsSUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNoRCxlQUFLLENBQUMsUUFBUSxDQUFDLGNBQWMsQ0FBQyxFQUFDLElBQUksTUFBQSxFQUFFLE1BQU0sUUFBQSxFQUFDLENBQUMsQ0FBQztJQUNsRCxDQUFDO0lBRU0sMkJBQU0sR0FBYjtRQUNJLGVBQUssQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFLENBQUM7SUFDNUIsQ0FBQztJQUVPLDZCQUFRLEdBQWhCO1FBQ0ksSUFBTSxPQUFPLEdBQUcsV0FBVyxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQ3RDLE9BQU8sQ0FBQyxRQUFRLENBQUMseUJBQXlCLENBQUMsQ0FBQztJQUNoRCxDQUFDO0lBRUwsaUJBQUM7QUFBRCxDQUFDLEFBcEdELElBb0dDO0FBQ0QsSUFBSSxVQUFVLEdBQUcsSUFBSSxDQUFDO0FBQ3RCLE9BQU8sQ0FBQyxTQUFTLEdBQUcsVUFBVSxJQUFJO0lBQzlCLEVBQUUsQ0FBQSxDQUFDLENBQUMsVUFBVSxDQUFDLENBQUEsQ0FBQztRQUNaLFVBQVUsR0FBRyxJQUFJLFVBQVUsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDN0MsQ0FBQztBQUNMLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBtb2RlbCBmcm9tICcuLi8uLi9tb2RlbC9tb2RlbCc7XG5pbXBvcnQgYnV0dG9uTW9kdWxlID0gcmVxdWlyZShcInVpL2J1dHRvblwiKTtcbmNvbnN0IGJ1aWxkZXIgPSByZXF1aXJlKCd1aS9idWlsZGVyJyk7XG5pbXBvcnQge2FkZFplcm9EaWdpdH0gZnJvbSAnLi4vLi4vdXRpbC91dGlsJztcbmltcG9ydCBmcmFtZU1vZHVsZSA9IHJlcXVpcmUoXCJ1aS9mcmFtZVwiKTtcblxuY2xhc3MgRGFpbHlDaGVjayB7XG5cbiAgICBwcml2YXRlIGJ0blN1Ym1pdDtcbiAgICBwcml2YXRlIGhhYml0Q29udGFpbmVyO1xuICAgIHByaXZhdGUgYnRuVG9tb3Jyb3c7XG4gICAgcHJpdmF0ZSBidG5ZZXN0ZXJkYXk7XG4gICAgcHJpdmF0ZSBkYXRlO1xuICAgIHByaXZhdGUgdG9kYXlEYXRlO1xuICAgIHByaXZhdGUgYnRuUmVzdWx0O1xuXG4gICAgY29uc3RydWN0b3IocGFnZSl7XG4gICAgICAgIHRoaXMuYnRuU3VibWl0ID0gcGFnZS5nZXRWaWV3QnlJZCgnYnRuU3VibWl0Jyk7XG4gICAgICAgIHRoaXMuaGFiaXRDb250YWluZXIgPSBwYWdlLmdldFZpZXdCeUlkKCdoYWJpdENvbnRhaW5lcicpO1xuICAgICAgICB0aGlzLmJ0blRvbW9ycm93ID0gcGFnZS5nZXRWaWV3QnlJZCgnYnRuVG9tb3Jyb3cnKTtcbiAgICAgICAgdGhpcy5idG5ZZXN0ZXJkYXkgPSBwYWdlLmdldFZpZXdCeUlkKCdidG5ZZXN0ZXJkYXknKTtcbiAgICAgICAgdGhpcy5kYXRlID0gcGFnZS5nZXRWaWV3QnlJZCgnZGF0ZScpO1xuICAgICAgICB0aGlzLmJ0blJlc3VsdCA9IHBhZ2UuZ2V0Vmlld0J5SWQoJ2J0blJlc3VsdCcpO1xuXG4gICAgICAgIHRoaXMuZGVmYXVsdFNldHRpbmcoKTtcbiAgICAgICAgdGhpcy5ldmVudFNldHRpbmcoKTtcbiAgICAgICAgdGhpcy5tYWtlTXlIYWJpdHMobW9kZWwudXNlckluZm8ubXlIYWJpdHMpO1xuICAgIH1cblxuICAgIHByaXZhdGUgZGVmYXVsdFNldHRpbmcoKSB7XG4gICAgICAgIHRoaXMudG9kYXlEYXRlID0gbmV3IERhdGUoKTtcbiAgICAgICAgdGhpcy5zZXREYXRlKHRoaXMudG9kYXlEYXRlKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHNldERhdGUoZGF0ZSl7XG4gICAgICAgIHRoaXMuZGF0ZS50ZXh0ID0gYCR7ZGF0ZS5nZXRGdWxsWWVhcigpfS4ke2FkZFplcm9EaWdpdChkYXRlLmdldE1vbnRoKCkrMSl9LiR7ZGF0ZS5nZXREYXRlKCl9YDtcbiAgICB9XG5cbiAgICBwcml2YXRlIGFkZEhhYml0KGhhYml0RGJEYXRhID0gbnVsbCkge1xuICAgICAgICBjb25zdCBoYWJpdCA9IGJ1aWxkZXIubG9hZCh7XG4gICAgICAgICAgICBwYXRoOiAnL2NvbXBvbmVudC9jcmVhdGUvaGFiaXQnLFxuICAgICAgICAgICAgbmFtZTogJ2hhYml0J1xuICAgICAgICB9KTtcblxuICAgICAgICBoYWJpdC5nZXRWaWV3QnlJZCgnaGFiaXROYW1lJykudGV4dCA9IGhhYml0RGJEYXRhLnRpdGxlO1xuICAgICAgICB0aGlzLmhhYml0Q29udGFpbmVyLmFkZENoaWxkKGhhYml0KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGV2ZW50U2V0dGluZygpIHtcbiAgICAgICAgdGhpcy5idG5TdWJtaXQub24oYnV0dG9uTW9kdWxlLkJ1dHRvbi50YXBFdmVudCwgKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5nb1N1Ym1pdCgpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5idG5Ub21vcnJvdy5vbihidXR0b25Nb2R1bGUuQnV0dG9uLnRhcEV2ZW50LCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmdvVG9tbW9ycm93KCk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmJ0blllc3RlcmRheS5vbihidXR0b25Nb2R1bGUuQnV0dG9uLnRhcEV2ZW50LCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmdvWWVzdGVyZGF5KCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuYnRuUmVzdWx0Lm9uKGJ1dHRvbk1vZHVsZS5CdXR0b24udGFwRXZlbnQsICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZ29SZXN1bHQoKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnb1RvbW1vcnJvdygpIHtcbiAgICAgICAgdGhpcy50b2RheURhdGUuc2V0RGF0ZSh0aGlzLnRvZGF5RGF0ZS5nZXREYXRlKCkgKyAxKTtcbiAgICAgICAgdGhpcy5zZXREYXRlKHRoaXMudG9kYXlEYXRlKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdvWWVzdGVyZGF5KCkge1xuICAgICAgICB0aGlzLnRvZGF5RGF0ZS5zZXREYXRlKHRoaXMudG9kYXlEYXRlLmdldERhdGUoKSAtIDEpO1xuICAgICAgICB0aGlzLnNldERhdGUodGhpcy50b2RheURhdGUpO1xuICAgIH1cblxuICAgIHByaXZhdGUgbWFrZU15SGFiaXRzKG15SGFiaXRzKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdteUhhYml0c215SGFiaXRzJywgSlNPTi5zdHJpbmdpZnkobXlIYWJpdHMpKTtcbiAgICAgICAgaWYoIW15SGFiaXRzIHx8IG15SGFiaXRzLmxlbmd0aCA9PSAwKXtcbiAgICAgICAgICAgIHRoaXMuYWRkSGFiaXQoKTsgICAgXG4gICAgICAgIH1lbHNle1xuICAgICAgICAgICAgbXlIYWJpdHMuZm9yRWFjaChoYWJpdCA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hZGRIYWJpdChoYWJpdCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBnb1N1Ym1pdCgpe1xuICAgICAgICBsZXQgaGFiaXRzOiBBcnJheTxPYmplY3Q+ID0gW107XG4gICAgICAgIHRoaXMuaGFiaXRDb250YWluZXIuZWFjaENoaWxkVmlldyhjaGlsZCA9PiB7XG4gICAgICAgICAgICBoYWJpdHMucHVzaCh7XG4gICAgICAgICAgICAgICAgdGl0bGU6IGNoaWxkLmdldFZpZXdCeUlkKCdoYWJpdE5hbWUnKS50ZXh0LFxuICAgICAgICAgICAgICAgIHZhbHVlOiBOdW1iZXIoY2hpbGQuZ2V0Vmlld0J5SWQoJ2hhYml0Q291bnQnKS50ZXh0KVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBkYXRlID0gdGhpcy5kYXRlLnRleHQuc3BsaXQoJy4nKS5qb2luKCcnKTtcbiAgICAgICAgbW9kZWwudXNlckluZm8uc2V0RGFpbHlIYWJpdHMoe2RhdGUsIGhhYml0c30pO1xuICAgIH1cblxuICAgIHB1YmxpYyBsb2dvdXQoKSB7XG4gICAgICAgIG1vZGVsLnVzZXJJbmZvLmxvZ291dCgpO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ29SZXN1bHQoKSB7XG4gICAgICAgIGNvbnN0IHRvcG1vc3QgPSBmcmFtZU1vZHVsZS50b3Btb3N0KCk7XG4gICAgICAgIHRvcG1vc3QubmF2aWdhdGUoXCJjb21wb25lbnQvcmVzdWx0L3Jlc3VsdFwiKTtcbiAgICB9XG5cbn1cbmxldCBkYWlseUNoZWNrID0gbnVsbDtcbmV4cG9ydHMubmF2aWdhdGVkID0gZnVuY3Rpb24gKGFyZ3MpIHtcbiAgICBpZighZGFpbHlDaGVjayl7XG4gICAgICAgIGRhaWx5Q2hlY2sgPSBuZXcgRGFpbHlDaGVjayhhcmdzLm9iamVjdCk7XG4gICAgfVxufTsiXX0=